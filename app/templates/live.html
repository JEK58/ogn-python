{% extends "base.html" %}

{% block styles %}
    {{super()}}
	<style>
	html, body {
		height: 100%;
		margin: 0;
		padding: 0;
	}
	#map {
		height: 100%;
    }
	</style>
{% endblock %}

{% block content %} 
	<div id="map"></div>
	<script>

var map;
function initMap() {
	google.maps.event.addDomListener(window, 'load', function() {
	    var map;
	    var mapOptions = {
	            zoom: 8,
	            center: new google.maps.LatLng(48, 11),
	            mapTypeId: google.maps.MapTypeId.TERRAIN
	    }
	
		map = new google.maps.Map(document.getElementById('map'), mapOptions);
	    
	    $.getJSON('/aircraft_beacons', function(data){ 
	        $.each(data.aircraft_beacons, function(i, item) {
	            var latlng = new google.maps.LatLng(item.lat,item.lng);
	            var marker = new google.maps.Marker({
	            	address: i,
	                position: latlng,
	                map: map
	            });
	            if (item.registration === null) {
	            	marker.setTitle(i);
	            } else {
	            	marker.setIcon('http://maps.google.com/mapfiles/marker_yellow.png');
	            	marker.setTitle(item.registration);
	            }
	            
	            
	            marker.addListener('click', function() {
	            	var mypath = new Array();
	                $.getJSON('positions/' + marker.address, function(data) {
	                	var i = 0;
	                	$.each(data.positions, function(j, item2) {
	                		var position = new google.maps.LatLng(item2.lat, item2.lng);
	                		mypath.push(position);
	                		i = i + 1;
	                	})
	                	
	                	var polyline = new google.maps.Polyline({
		                    path: mypath,
		                    strokeColor: '#ff0000',
		                    strokeOpacity: 1.0,
		                    strokeWeight: 3
		                });
		                
		                polyline.setMap(map);
	                });
	           	});
	        });        
	    });
	});
}

	</script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSrHEX6a5Lii_w3Uao-bToYvnfAtX5ivE&signed_in=true&callback=initMap"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
{% endblock %}