{% extends "base.html" %}

{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/flags/flags.css') }}"/>

<div class="container">
<div class="panel panel-success">
<div class="panel-heading"><h3 class="panel-title">Receiver Ranking</h3></div>
<div class="panel-body">

  <form>
    <div class="well">
    <select name="country" onchange="this.form.submit();">
      <option value="">(all)</option>
        {% for country in countries %}
        <option value="{{ country.iso2 }}"{% if sel_country == country.iso2 %} SELECTED{% endif %}>{{ country.iso2 }}</option>
        {% endfor %}
    </select>
    </div>
  </form>

  <table id="myTable" class="table table-striped table-bordered tablesorter tablesorter-bootstrap">
    <thead>
      <tr>
        <th class="text-right" colspan="2">Rank</th>
        <th class="text-right">Today</th>
        <th>Name</th>
        <th>Airport</th>
        <th class="text-right">Distance [km]</th>
        <th class="text-right">Normalized signal quality [dB]</th>
        <th class="text-right">Senders</th>
        <th class="text-right">Coverages</th>
        <th class="text-right">Messages</th>
      </tr>
    </thead>

    <tbody>
    {% for entry in ranking %}
    {% if sel_country is none or sel_country == '' %}
      {% set rank = entry.global_rank %}{% set longtime_rank = entry.longtime_global_rank %}{% set longtime_rank_delta = entry.longtime_global_rank_delta %}
    {% else %}
      {% set rank = entry.local_rank %}{% set longtime_rank = entry.longtime_local_rank %}{% set longtime_rank_delta = entry.longtime_local_rank_delta %}
    {% endif %}
      <tr>
        <td class="text-right">{{ longtime_rank }}</td>
        <td class="text-right">{% if longtime_rank_delta is none %}{% elif longtime_rank_delta > 0 %}<span class="text-success"><i class="fa fa-long-arrow-up"></i>{{ longtime_rank_delta }}</span>{% elif longtime_rank_delta < 0 %}<span class="text-danger"><i class="fa fa-long-arrow-down"></i>{{ -longtime_rank_delta }}</span>{% endif %}</td>
        <td class="text-right">{{ rank }}</td>
        <td>{{ entry.receiver.country|to_html_flag|safe }} {{ entry.receiver|to_html_link|safe }}</td>
        <td>{{ entry.receiver.airport|to_html_link|safe }}</td>
        <td class="text-right">{{ '%0.1f' | format(entry.max_distance/1000.0) }}</td>
        <td class="text-right">{{ '%0.1f' | format(entry.max_normalized_quality) }}</td>
        <td class="text-right">{{ entry.senders_count }}</td>
        <td class="text-right">{{ entry.coverages_count }}</td>
        <td class="text-right">{{ entry.messages_count }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
</div>

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    $(function() {
      $("#myTable").tablesorter({sortList: [[0,0]], theme:"bootstrap", headerTemplate:"{content} {icon}", widgets:["uitheme"]});
    });
  </script>
{% endblock %}
